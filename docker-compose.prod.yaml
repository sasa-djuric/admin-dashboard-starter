version: '3'
services:
    db:
        container_name: db
        build: ./db
        command: --default-authentication-plugin=mysql_native_password
        volumes:
            - mysql-volume:/var/lib/mysql
        ports:
            - 3306:3306
        expose:
          - 3306
        environment:
            - MYSQL_DATABASE=main
            - MYSQL_ROOT_PASSWORD=password
        security_opt:
            - seccomp:unconfined

    backend:
        container_name: health-center_backend
        restart: always
        build: ./backend
        volumes:
            - '/app/node_modules'
            - ./backend:/app
        ports:
            - 9021:3000
        expose:
            - 9021
        depends_on:
            - db
        environment:
            VIRTUAL_HOST: health-center.sasadjuric.dev/api
            LETSENCRYPT_HOST: health-center.sasadjuric.dev
            LETSENCRYPT_EMAIL: djsasa.mail@gmail.com

    dashboard:
        container_name: health-center_dashboard
        build: ./dashboard
        restart: always
        ports:
            - 9022:80
        environment:
            VIRTUAL_HOST: health-center.sasadjuric.dev/dashboard
            LETSENCRYPT_HOST: health-center.sasadjuric.dev
            LETSENCRYPT_EMAIL: djsasa.mail@gmail.com
            NODE_ENV: production
        expose:
            - 9022

    web:
        container_name: health-center_web
        build: ./web-app
        restart: always
        ports:
            - 9020:80
        environment:
            VIRTUAL_HOST: health-center.sasadjuric.dev
            LETSENCRYPT_HOST: health-center.sasadjuric.dev
            LETSENCRYPT_EMAIL: djsasa.mail@gmail.com
        expose:
            - 9020

volumes:
    mysql-volume:

networks:
    default:
        external:
            name: nginx-proxy
